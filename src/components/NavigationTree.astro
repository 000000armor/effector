---
import { markActiveNavigation, MOBILE_NAVIGATION, SOCIAL_LINKS } from "../navigation";
import { getPathParamsFromId } from "../languages";

import NestedLinks from "./NestedLinks.astro";

import IconGithub from "../icons/Github.astro";
import IconTwitter from "../icons/Twitter.astro";
import IconDiscord from "../icons/Discord.astro";
import IconYoutube from "../icons/Youtube.astro";

const socialIcons = {
  github: IconGithub,
  twitter: IconTwitter,
  discord: IconDiscord,
  youtube: IconYoutube,
};

const { slug } = getPathParamsFromId(Astro.url.pathname);
const activeNavigation = markActiveNavigation(`/${slug}`, MOBILE_NAVIGATION);
---

<div class="navigation">
  <nav>
    <NestedLinks items={activeNavigation} firstLevel />
  </nav>
  <footer>
    {
      SOCIAL_LINKS.map((link) => {
        const Icon = socialIcons[link.icon];
        return (
          <a class="social" href={link.link} class="link only-medium" target="_blank">
            <Icon />
          </a>
        );
      })
    }
  </footer>
</div>

<style>
  :global(.mobile-menu-opened) .navigation {
    display: flex;
  }

  .navigation {
    @apply fixed z-50 hidden w-screen flex-col overflow-hidden overflow-y-auto;

    top: var(--theme-navbar-height);
    bottom: 0;

    will-change: transform, opacity;
    contain: layout style;
    backface-visibility: hidden;
    background-color: var(--theme-bg);
  }

  nav {
    @apply flex grow flex-col overflow-y-auto py-4;
    font-family: "Lexend Deca", sans-serif;

    overscroll-behavior: contain;
    padding-left: max(env(safe-area-inset-left), 1rem);
    padding-right: max(env(safe-area-inset-right), 1rem);
  }

  footer {
    @apply z-10 flex gap-2 py-2;

    padding-left: max(env(safe-area-inset-left), 1rem);
    padding-right: max(env(safe-area-inset-right), 1rem);

    box-shadow: 0 -4px 6px -4px rgb(0 0 0 / 0.1);
    background-color: var(--theme-bg);
  }

  .social {
    @apply cursor-pointer rounded py-3 px-3 transition-colors;
    color: var(--theme-text);
  }

  .social:hover {
    background-color: var(--theme-divider);
  }
</style>
